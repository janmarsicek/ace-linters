<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ace linters demo</title>

</head>
<body>
Language:
<select id="lang">
    <option value="html">HTML</option>
    <option value="css">CSS</option>
    <option value="less">LESS</option>
    <option value="scss">SCSS</option>
    <option value="json">JSON</option>
</select><br>
<div id="container" style="width: 100%; height: 300px">

</div>
<script src="bundle.simple.js"></script>
<script>
    var lang = document.getElementById("lang");

    async function validate() {
        window.editor.session.clearAnnotations();
        var annotations = await window["worker"].doValidation();
        if (annotations && annotations.length > 0) {
            window.editor.session.setAnnotations(annotations);
        }
    }

    async function doComplete() {
        var cursor = window.editor.getCursorPosition();
        var completions = await window["worker"].doComplete(cursor);
        return completions;
    }

    function registerCompleters() {
        window.editor.completers = [
            {
                getCompletions: async function (editor, session, pos, prefix, callback) {
                    var completions = await doComplete();
                    callback(null, completions);
                },
                getDocTooltip: function (item) {
                    if (!item.docHTML && item.doc) {
                        item.docHTML = [
                            "<b>", (typeof item.doc == "string") ? item.doc : item.doc?.value, "</b>", "<hr>",
                            item.snippet
                        ].join("");
                    }
                }
            }
        ];
    }

    lang.onchange = async () => {
        if (lang.value && window[lang.value]) {
            var session = window.editor.session;
            session.setMode(window[lang.value].mode);
            session.setValue(window[lang.value].content);
            window["worker"] = window[lang.value].worker;
            if (window["worker"].changeLanguageService !== undefined) {
                window["worker"].changeLanguageService(undefined, lang.value);
            }
            window.editor.on("input", () => {
                validate();
            });

            registerCompleters();
            await validate();
        }
    };
    registerCompleters();
</script>
</body>
</html>